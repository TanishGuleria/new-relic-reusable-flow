name: CD Terraform ReUsable Workflow
on:
  workflow_call:
    inputs:
      environment:
        description: 'Environment to deploy the team-onboarding to'
        required: true
        type: choice
        options:
          - inf
          - dev
          - qa
          - prod
          - all
      branch:
        description: 'Branch to deploy the Service Terraform code from'
        required: true
        default: 'main'
        type: string
    secrets:
      PAT_TOKEN:
        required: true

jobs:
  deploy-inf:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          ref: ${{ inputs.branch }}
          token: ${{ secrets.GITHUB_TOKEN }}
      - name: Deploy to inf
        run: |
          echo "Deploying to inf environment"
          # Add your deployment script/commands here
        env:
          ENVIRONMENT: inf

  deploy-dev:
    runs-on: ubuntu-latest
    needs: deploy-inf
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          ref: ${{ inputs.branch }}
          token: ${{ secrets.GITHUB_TOKEN }}
      - name: Deploy to dev
        run: |
          echo "Deploying to dev environment"
          # Add your deployment script/commands here
        env:
          ENVIRONMENT: dev

  deploy-qa:
    runs-on: ubuntu-latest
    needs: deploy-dev
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          ref: ${{ inputs.branch }}
          token: ${{ secrets.GITHUB_TOKEN }}
      - name: Deploy to qa
        run: |
          echo "Deploying to qa environment"
          # Add your deployment script/commands here
        env:
          ENVIRONMENT: qa

  deploy-prod:
    runs-on: ubuntu-latest
    needs: deploy-qa
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          ref: ${{ inputs.branch }}
          token: ${{ secrets.GITHUB_TOKEN }}
      - name: Deploy to prod
        run: |
          echo "Deploying to prod environment"
          # Add your deployment script/commands here
        env:
          ENVIRONMENT: prod